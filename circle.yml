
dependencies:
  cache_directories:
    - "~/.stack"
  pre:
    - wget -qO- https://get.haskellstack.org/ | sh
  override:
    - stack setup
    - stack clean
    - stack build

test:
  override:
    - stack test

deployment:
  release_branch:
    owner: haskell-works
    branch: /.*-branch/
    commands:
      - nox when tag autotag

  hackage:
    owner: haskell-works
    tag: /v.*/
    commands:
      - ./scripts/setup-cred
      - stack sdist
      - stack upload .
